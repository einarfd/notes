{% extends "base.html" %}

{% block title %}New Note - Notes{% endblock %}

{% block content %}
<div class="card">
    <h2>Create New Note</h2>
    {% if error %}
    <div class="error-message">{{ error }}</div>
    {% endif %}
    <form method="POST" action="/new">
        <div class="form-group">
            <label for="path">Path</label>
            <input type="text" id="path" name="path" placeholder="e.g., projects/my-project" value="{{ path or '' }}" required>
        </div>
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" id="title" name="title" value="{{ title or '' }}" required>
        </div>
        <div class="form-group">
            <label for="tags">Tags (comma-separated)</label>
            <input type="text" id="tags" name="tags" placeholder="e.g., python, tutorial" value="{{ tags or '' }}">
        </div>
        <div class="form-group">
            <div class="content-header">
                <label for="content">Content</label>
                <div class="preview-toggle">
                    <button type="button" id="edit-tab" class="tab-btn active" onclick="showEdit()">Edit</button>
                    <button type="button" id="preview-tab" class="tab-btn" onclick="showPreview()">Preview</button>
                </div>
            </div>
            <textarea id="content" name="content">{{ content or '' }}</textarea>
            <div id="preview-pane" class="note-content rendered-markdown" style="display: none;"></div>
        </div>
        <div class="actions">
            <button type="submit" class="btn">Create Note</button>
            <a href="/" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
    <script>
        function showEdit() {
            document.getElementById('content').style.display = 'block';
            document.getElementById('preview-pane').style.display = 'none';
            document.getElementById('edit-tab').classList.add('active');
            document.getElementById('preview-tab').classList.remove('active');
        }
        function showPreview() {
            const content = document.getElementById('content').value;
            const previewPane = document.getElementById('preview-pane');

            fetch('/preview', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'content=' + encodeURIComponent(content)
            })
            .then(response => response.text())
            .then(html => {
                previewPane.innerHTML = html;
                document.getElementById('content').style.display = 'none';
                previewPane.style.display = 'block';
                document.getElementById('edit-tab').classList.remove('active');
                document.getElementById('preview-tab').classList.add('active');
            });
        }
    </script>
</div>
{% endblock %}
